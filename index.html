<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人资料查询系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #6c63ff;
            --secondary-color: #4a44b5;
            --light-bg: #f8f9fa;
            --dark-text: #333;
            --light-text: #6c757d;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: var(--dark-text);
            padding-top: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .search-container {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }
        
        .results-container {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            display: none;
        }
        
        .chart-container {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }
        
        .table th {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .highlight {
            background-color: rgba(108, 99, 255, 0.1);
        }
        
        .no-results {
            text-align: center;
            padding: 2rem;
            color: var(--light-text);
        }
        
        footer {
            text-align: center;
            padding: 1rem;
            color: var(--light-text);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header p {
                font-size: 1rem;
            }
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--light-text);
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 页面标题区域 -->
        <div class="header text-center">
            <h1 class="display-5 fw-bold">经开区2025引进查询</h1>
            <p class="lead">在下方输入查询条件，只显示前5条</p>
        </div>

        <!-- 错误提示区域 -->
        <div class="error-message" id="errorMessage">
            <strong>错误：</strong> <span id="errorText">无法加载数据文件</span>
        </div>

        <!-- 查询表单区域 -->
        <div class="search-container">
            <form id="searchForm">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="name" class="form-label">姓名</label>
                        <input type="text" class="form-control" id="name" placeholder="请输入姓名">
                    </div>
                    <div class="col-md-4">
                        <label for="age" class="form-label">年龄</label>
                        <input type="number" class="form-control" id="age" placeholder="请输入年龄">
                    </div>
                    <div class="col-md-4">
                        <label for="education" class="form-label">学历</label>
                        <select class="form-select" id="education">
                            <option value="">全部学历</option>
                            <option value="本科">本科</option>
                            <option value="硕士">硕士</option>
                            <option value="博士">博士</option>
                            <option value="大专">大专</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="school" class="form-label">学校</label>
                        <input type="text" class="form-control" id="school" placeholder="请输入学校名称">
                    </div>
                    <div class="col-12 mt-4">
                        <button type="submit" class="btn btn-primary px-4 py-2">
                            查询
                        </button>
                        <button type="button" class="btn btn-outline-secondary ms-2 px-4 py-2" id="resetBtn">
                            重置
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- 加载提示 -->
        <div class="loading" id="loadingMessage">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">加载中...</span>
            </div>
            <p class="mt-2">正在加载数据...</p>
        </div>

        <!-- 查询结果区域 -->
        <div class="results-container" id="resultsContainer">
            <h3 class="mb-3">查询结果</h3>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>姓名</th>
                            <th>年龄</th>
                            <th>学历</th>
                            <th>学校</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                        <!-- 查询结果将在这里动态显示 -->
                    </tbody>
                </table>
            </div>
            <div class="no-results" id="noResults" style="display: none;">
                <h4 class="mt-3">未找到匹配的结果</h4>
                <p>请尝试调整查询条件或重置查询</p>
            </div>
        </div>


        <!-- 页脚 -->
        <footer>
            <p>© 2023 GitHub个人博客 | 个人资料查询系统</p>
        </footer>
    </div>

    <script>
        // 全局变量，存储从CSV加载的数据
        let allData = [];
        let educationChart, ageChart;

        document.addEventListener('DOMContentLoaded', function() {
            // 加载CSV数据
            loadCSVData();

            // 表单提交事件
            document.getElementById('searchForm').addEventListener('submit', function(e) {
                e.preventDefault();
                performSearch();
            });

            // 重置按钮事件
            document.getElementById('resetBtn').addEventListener('click', function() {
                document.getElementById('searchForm').reset();
                // 重置后显示所有数据
                displayResults(allData);
                updateCharts(allData);
            });
        });

        // 从CSV文件加载数据
        function loadCSVData() {
            // 显示加载提示
            document.getElementById('loadingMessage').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';

            // 使用PapaParse加载CSV文件
            Papa.parse('data.csv', {
                download: true,
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    // 隐藏加载提示
                    document.getElementById('loadingMessage').style.display = 'none';

                    if (results.errors.length > 0) {
                        showError('CSV文件解析错误: ' + results.errors[0].message);
                        return;
                    }

                    if (results.data.length === 0) {
                        showError('CSV文件中没有数据');
                        return;
                    }

                    // 将数据存储在全局变量中
                    allData = results.data;

                },
                error: function(error) {
                    // 隐藏加载提示
                    document.getElementById('loadingMessage').style.display = 'none';
                    showError('无法加载CSV文件: ' + error.message);
                }
            });
        }

        // 显示错误信息
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
        }

        // 执行搜索
        function performSearch() {
            const name = document.getElementById('name').value.toLowerCase();
            const age = document.getElementById('age').value;
            const education = document.getElementById('education').value;
            const school = document.getElementById('school').value.toLowerCase();

            // 过滤数据
            const filteredData = allData.filter(item => {
                return (
                    (name === '' || (item.name && item.name.toLowerCase().includes(name))) &&
                    (age === '' || item.age == age) &&
                    (education === '' || item.education === education) &&
                    (school === '' || (item.school && item.school.toLowerCase().includes(school)))
                );
            });

            // 显示结果
            displayResults(filteredData);
        }

        // 显示查询结果
        function displayResults(data) {
            const resultsBody = document.getElementById('resultsBody');
            const resultsContainer = document.getElementById('resultsContainer');
            const noResults = document.getElementById('noResults');

            resultsBody.innerHTML = '';

            if (data.length === 0) {
                resultsContainer.style.display = 'block';
                noResults.style.display = 'block';
                return;
            }
            if (data.length >5){
                data = data.slice(0, 5);
            }
            noResults.style.display = 'none';

            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name || 'N/A'}</td>
                    <td>${item.age || 'N/A'}</td>
                    <td>${item.education || 'N/A'}</td>
                    <td>${item.school || 'N/A'}</td>
                `;
                resultsBody.appendChild(row);
            });

            resultsContainer.style.display = 'block';
        }



    </script>
</body>
</html>